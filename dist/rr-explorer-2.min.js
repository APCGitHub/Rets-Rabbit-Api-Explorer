!function(){"use strict";angular.module("rr.api.v2.explorer",["rets-rabbit-angular","ngAnimate","uiGmapgoogle-maps","rr.api.v2.explorer.directives","rr.api.v2.explorer.filters","rr.api.v2.explorer.templates"])}();
angular.module("rr.api.v2.explorer.templates",[]).run(["$templateCache",function(n){n.put("explorer.bootstrap.html",'<div class="rets-rabbit-explorer">\n	<!-- FORM -->\n	<div class="row">\n		<!-- QUERY BUILDER -->\n	    <div class="col-sm-6 col-xs-12">\n	        <h3>Build Query</h3>\n	        <form ng-submit="vm.doSearch(explorerForm.$valid)" name="explorerForm" role="form" class="form-horizontal" novalidate>\n	            <!-- SELECT -->\n	            <div class="form-group">\n	                <label class="control-label col-sm-2" for="select">$select:</label>\n	                <div class="col-sm-10">\n	                    <input class="form-control" ng-change="vm.updateQuery()" name="select" ng-model="vm.data.searchForm.select" id="select" type="text" />\n	                </div>\n	            </div>\n	            <!-- FILTER -->\n	            <div class="form-group">\n	                <label class="control-label col-sm-2" for="filter">$filter:</label>\n	                <div class="col-sm-10">\n	                    <div class="row" ng-repeat-start="filter in vm.data.searchForm.filter track by $index">\n	                        <div class="col-sm-10 col-xs-10">\n	                            <input ng-change="vm.updateQuery()" name="filter_{{$index}}" class="form-control" required ng-model="vm.data.searchForm.filter[$index].value" id="filter_{{$index+1}}" type="text" />\n	                            <div ng-show="explorerForm.$submitted || explorerForm.filter_{{$index}}.$touched">\n	                                <p ng-show="explorerForm.filter_{{$index}}.$invalid" class="help-block">\n	                                    <i class="fa fa-exclamation" aria-hidden="true"></i>&nbsp;Filter must not be empty\n	                                </p>\n	                            </div>\n	                        </div>\n	                        <!-- REMOVE FILTER -->\n	                        <div class="col-sm-2 col-xs-2">\n	                            <button type="button" class="btn btn-danger pull-right" ng-click="vm.removeFilter(filter)"><i class="fa fa-trash-o"></i></button>\n	                        </div>\n	                    </div>\n	                    <!-- JOIN: AND | OR -->\n	                    <div class="row" ng-repeat-end ng-if="$index + 1 < vm.data.searchForm.filter.length" style="margin-top:15px; margin-bottom:15px">\n	                        <div class="visible-xs col-xs-3"></div>\n	                        <div class="col-sm-3 col-sm-offset-4 col-xs-4 text-center">\n	                            <select ng-model="vm.data.searchForm.filter[$index].join" class="form-control" ng-change="vm.updateQuery()">\n	                                <option value="and" selected>and</option>\n	                                <option value="or">or</option>\n	                            </select>\n	                        </div>\n	                    </div>\n	                    <!-- EMPTY MESSAGE -->\n	                    <div class="row" ng-show="vm.data.searchForm.filter.length < 1">\n	                        <div class="col-sm-12">\n	                            <div class="bg-info" style="padding:7px"><i class="fa fa-info" aria-hidden="true"></i>&nbsp;Click the button below to add your first filter</div>\n	                        </div>\n	                    </div>\n	                    <!-- ADD FILTER -->\n	                    <div class="row">\n	                        <div class="col-sm-12 col-xs-12 text-center" style="margin-top:20px">\n	                            <button type="button" class="btn btn-success pull-right" ng-click="vm.addFilter()"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;Add Filter</button>\n	                        </div>\n	                    </div>\n	                </div>\n	            </div>\n	            <!-- ORDERBY -->\n	            <div class="form-group">\n	                <label class="control-label col-sm-2" for="orderby">$orderby:</label>\n	                <div class="col-sm-10">\n	                    <div style="margin-bottom:15px" class="row" ng-repeat="orderby in vm.data.searchForm.orderby track by $index">\n	                        <div class="col-sm-7 col-xs-6">\n	                            <input name="orderby_{{$index}}" ng-model="vm.data.searchForm.orderby[$index].value" id="orderby_input_{{$index+1}}" class="form-control" required value="orderby.value" ng-change="vm.updateQuery()" type="text" />\n	                            <div ng-show="explorerForm.$submitted || explorerForm.orderby_{{$index}}.$touched">\n	                                <p ng-show="explorerForm.orderby_{{$index}}.$invalid" class="help-block"><i class="fa fa-exclamation" aria-hidden="true"></i>&nbsp;Orderby must not be empty</p>\n	                            </div>\n	                        </div>\n	                        <div class="col-sm-3 col-xs-3">\n	                            <select ng-model="vm.data.searchForm.orderby[$index].direction" class="form-control" ng-change="vm.updateQuery()">\n	                                <option value="asc" selected>asc</option>\n	                                <option value="desc">desc</option>\n	                            </select>\n	                        </div>\n	                        <!-- REMOVE FILTER -->\n	                        <div class="col-sm-2 col-xs-3">\n	                            <button type="button" class="btn btn-danger pull-right" ng-click="vm.removeOrderby(orderby)"><i class="fa fa-trash-o"></i></button>\n	                        </div>\n	                    </div>\n	                    <!-- EMPTY MESSAGE -->\n	                    <div class="row" ng-show="vm.data.searchForm.orderby.length < 1" style="margin-bottom:20px">\n	                        <div class="col-sm-12">\n	                            <div class="bg-info" style="padding:7px"><i class="fa fa-info" aria-hidden="true"></i>&nbsp;Click the button below to add your first orderby</div>\n	                        </div>\n	                    </div>\n	                    <!-- ADD ORDERBY -->\n	                    <div class="row">\n	                        <div class="col-sm-12 col-xs-12 text-center">\n	                            <button type="button" class="btn btn-success pull-right" ng-click="vm.addOrderby()"><i class="fa fa-plus" aria-hidden="true"></i>&nbsp;Add Orderby</button>\n	                        </div>\n	                    </div>\n	                </div>\n	            </div>\n	            <!-- TOP -->\n	            <div class="form-group">\n	                <label class="control-label col-sm-2" for="top">$top:</label>\n	                <div class="col-sm-4">\n	                    <input ng-change="vm.updateQuery()" ng-model="vm.data.searchForm.top" name="top" class="form-control" id="top" type="tel" />\n	                </div>\n	                <div class="visible-xs">&nbsp;\n	                    <br>\n	                </div>\n	                <!-- SKIP -->\n	                <label class="control-label col-sm-2" for="skip">$skip:</label>\n	                <div class="col-sm-4">\n	                    <input ng-change="vm.updateQuery()" ng-model="vm.data.searchForm.skip" name="skip" class="form-control" id="skip" type="tel" />\n	                </div>\n	            </div>\n	            <div class="form-group">\n	                <div class="col-sm-12 col-xs-12">\n	                    <button type="submit" class="btn btn-primary pull-right" ng-disabled="vm.data.searching" value="search">\n	                        <span ng-if="!vm.data.searching">Search</span>\n	                        <span ng-if="vm.data.searching">Searching...</span>\n	                    </button>\n	                </div>\n	            </div>\n	        </form>\n	        <br><br>\n	        <h3>Request</h3>\n	        <code style="display:block; padding:10px">\n				{{vm.data.fullRequest}}\n			</code>\n	    </div>\n	    <!-- REQUEST -->\n	    <div class="col-sm-6 col-xs-12">\n	        <h3>Interactive Map</h3>\n	        <p>You can further narrow your searches by drawing bounding polygon shapes on the map for areas of interest.</p>\n	        <ui-gmap-google-map center=\'vm.data.map.center\' zoom=\'vm.data.map.zoom\'>\n	        	<ui-gmap-marker ng-repeat="m in vm.data.map.markers" coords="m.coords" idKey="m.id"></ui-gmap-marker>\n	        	<ui-gmap-drawing-manager options="vm.data.map.drawingManagerOptions" control="vm.data.map.drawingManagerControl" static="\'false\'"></ui-gmap-drawing-manager>\n	        </ui-gmap-google-map>\n	    </div>\n    </div>\n    <div class="row">\n        <div class="col-sm-12">\n            <br>\n            <hr>\n        </div>\n    </div>\n    <div class="row">\n    	<!-- RESULTS -->\n        <div class="col-md-10 col-md-offset-1 col-sm-12" id="rr-query-results">\n            <h3 class="text-center">\n				Results\n				<span ng-if="vm.data.total_results > -1">:&nbsp;{{vm.data.total_results}}</span>\n				<span class="pull-right" ng-if="vm.data.total_results > -1"><i>{{vm.data.query_time}}ms</i></span>\n			</h3>\n            <img style="display:block; margin-left: auto; margin-right: auto" ng-if="vm.data.searching && vm.loader" ng-src="{{vm.loader}}">\n            <div class="results" ng-if="vm.data.results && !vm.data.error">\n                <pre style="max-height:600px">{{vm.data.results | prettyJson}}</pre>\n            </div>\n            <div class="error" ng-if="vm.data.error">\n                <pre>{{vm.data.error | prettyJson}}</pre>\n            </div>\n            <div ng-if="!vm.data.error && !vm.data.results && !vm.data.searching">\n                <code class="text-center" style="display:block; padding:10px">Click "Search" to hit the Retsrabbit V2 API!</code>\n            </div>\n        </div>\n    </div>\n</div>\n')}]);
!function(){"use strict";function a(a,e){var t=["$scope","$interval","$timeout","$document","PropertyFactory","uiGmapGoogleMapApi","uiGmapIsReady",function(e,t,r,n,o,l,i){function s(a){if(a){O.data.total_results=-1,O.data.error=null,O.data.results=null,O.data.searching=!0;var e=new Date;o.search(O.data.request).then(function(a){n.scrollToElement(L,70,300);var t=new Date;O.data.error=null,O.data.results=a,O.data.total_results=a.value.length,O.data.searching=!1,u(t.getTime()-e.getTime()),m(a.value)},function(a){n.scrollToElement(L,70,300),O.data.query_time=-1,O.data.searching=!1,O.data.error=a?a.error:{}})}}function d(){O.data.searchForm.filter.push({value:"",join:"and"})}function g(a){var e=O.data.searchForm.filter.indexOf(a);O.data.searchForm.filter.splice(e,1),h()}function c(){O.data.searchForm.orderby.push({value:"",direction:"asc"})}function p(a){var e=O.data.searchForm.orderby.indexOf(a);O.data.searchForm.orderby.splice(e,1),h()}function h(){var e="",t=0,r=[0,0,0,0,0];if(""!==O.data.searchForm.select&&(r[0]=1,e+="$select="+O.data.searchForm.select),O.data.searchForm.filter.length||O.data.searchForm.geo.within.distance>0){for(r[1]=1,e+=r[0]?"&$filter=":"$filter=",t=0;t<O.data.searchForm.filter.length;t++)e+=O.data.searchForm.filter[t].value,""!==O.data.searchForm.filter[t].value&&t+1<O.data.searchForm.filter.length&&(e+=" "+O.data.searchForm.filter[t].join),t+1<O.data.searchForm.filter.length&&(e+=" ");O.data.searchForm.geo.within.distance>0&&(O.data.searchForm.filter.length&&(e+=" and "),e+="geo.distance(location, POINT("+O.data.searchForm.geo.within.center.lng+" "+O.data.searchForm.geo.within.center.lat+")) le "+O.data.searchForm.geo.within.distance,console.log("did hte distance")),O.data.searchForm.geo.intersects.points.length>0&&(O.data.searchForm.filter.length&&(e+=" and "),e+="geo.intersects(location, POLYGON((",e+=O.data.searchForm.geo.intersects.points.map(function(a){return a.lng+" "+a.lat}).join(", "),e+=")))",console.log("did the intersects"))}O.data.searchForm.orderby.length&&(r[2]=1,e+=r[0]+r[1]>0?"&$orderby=":"$orderby=",e+=O.data.searchForm.orderby.map(function(a){return""!==a.value?a.value+" "+a.direction:""}).join(", ")),""!=O.data.searchForm.top&&(r[3]=1,e+=r[0]+r[1]+r[2]>0?"&$top=":"$top=",e+=O.data.searchForm.top),""!=O.data.searchForm.skip&&(r[4]=1,e+=r[0]+r[1]+r[2]+r[3]>0?"&$skip=":"$skip=",e+=O.data.searchForm.skip),O.data.fullRequest=a.apiUrl+"property?"+e,O.data.request=e}function u(a){O.data.query_time=0;var e=5;a>750?O.data.query_time=a:C=t(function(e){O.data.query_time==a?t.cancel(C):O.data.query_time++},e)}function m(a){r(function(){O.data.map.markers=[]},1);for(var e=0;e<a.length;e++){var t=a[e],n={id:t.id,coords:{latitude:parseFloat(t.listing.lat),longitude:parseFloat(t.listing["long"])}};console.log(n),r(function(){O.data.map.markers.push(n)},1)}}function f(a){var e=a.getRadius(),t={lat:a.center.lat(),lng:a.center.lng()};O.data.searchForm.geo.within.center=t,O.data.searchForm.geo.within.distance=e/111195,r(function(){h()},1)}function y(a){O.data.searchForm.geo.intersects.points=a,r(function(){h()},1)}function v(a){switch(a){case 1:O.data.map.shape.rectangle=null,O.data.map.shape.polygon=null;break;case 2:O.data.map.shape.circle=null,O.data.map.shape.polygon=null;break;case 3:O.data.map.shape.circle=null,O.data.map.shape.rectangle=null}}function F(a){v(1);var e=null===O.data.map.shape.circle;O.data.map.shape.circle=a,f(O.data.map.shape.circle),e&&(O.data.map.shape.circle.addListener("radius_changed",function(){console.log("radius change"),f(O.data.map.shape.circle)}),O.data.map.shape.circle.addListener("center_changed",function(){console.log("circle center change"),f(O.data.map.shape.circle)}))}function w(a){v(2);var e=null===O.data.map.shape.rectangle;O.data.map.shape.rectangle=a;var t=[],r=a.getBounds(),n=r.getNorthEast(),o=r.getSouthWest();t.push({lat:n.lat(),lng:o.lng()}),t.push({lat:n.lat(),lng:n.lng()}),t.push({lat:o.lat(),lng:n.lng()}),t.push({lat:o.lat(),lng:o.lng()}),y(t),e&&google.maps.event.addListener(O.data.map.shape.rectangle,"bounds_changed",function(){console.log("bounds changed");var a=[],e=O.data.map.shape.rectangle.getBounds(),t=e.getNorthEast(),r=e.getSouthWest();a.push({lat:t.lat(),lng:r.lng()}),a.push({lat:t.lat(),lng:t.lng()}),a.push({lat:r.lat(),lng:t.lng()}),a.push({lat:r.lat(),lng:r.lng()}),y(a)})}function b(a){v(3);var e=null===O.data.map.shape.polygon;O.data.map.shape.polygon=a;for(var t=[],r=0;r<a.getPath().getLength();r++){var n=a.getPath().getAt(r);t.push({lat:n.lat(),lng:n.lng()})}y(t),e&&(google.maps.event.addListener(O.data.map.shape.polygon.getPath(),"set_at",function(){for(var e=[],t=0;t<a.getPath().getLength();t++){var r=a.getPath().getAt(t);e.push({lat:r.lat(),lng:r.lng()})}y(e)}),google.maps.event.addListener(O.data.map.shape.polygon.getPath(),"insert_at",function(){for(var e=[],t=0;t<a.getPath().getLength();t++){var r=a.getPath().getAt(t);e.push({lat:r.lat(),lng:r.lng()})}y(e)}),google.maps.event.addListener(O.data.map.shape.polygon.getPath(),"remove_at",function(){for(var e=[],t=0;t<a.getPath().getLength();t++){var r=a.getPath().getAt(t);e.push({lat:r.lat(),lng:r.lng()})}y(e)}))}function M(a,e){var t=document.createElement("div");t.style.backgroundColor="#fff",t.style.border="2px solid #fff",t.style.borderRadius="3px",t.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",t.style.cursor="pointer",t.style.marginBottom="22px",t.style.marginRight="10px",t.style.marginTop="10px",t.style.textAlign="center",t.title="Click to delete current selected shape",a.appendChild(t);var n=document.createElement("div");n.style.color="rgb(25,25,25)",n.style.fontFamily="Roboto,Arial,sans-serif",n.style.fontSize="16px",n.style.lineHeight="38px",n.style.paddingLeft="5px",n.style.paddingRight="5px",n.innerHTML="Delete Shape",t.appendChild(n),t.addEventListener("click",function(){O.data.map.shape.circle&&O.data.map.shape.circle.setMap(null),O.data.map.shape.rectangle&&O.data.map.shape.rectangle.setMap(null),O.data.map.shape.polygon&&O.data.map.shape.polygon.setMap(null),O.data.searchForm.geo.within.distance=-1,O.data.searchForm.geo.within.center={},O.data.searchForm.geo.intersects.points=[],O.data.map.drawingManagerControl.getDrawingManager()&&O.data.map.drawingManagerControl.getDrawingManager().setOptions({drawingControl:!0}),r(function(){h()},1)})}var C,O=this,L=angular.element(document.getElementById("rr-query-results")),x={fillColor:"#ec6952",fillOpacity:.5,editable:!0,draggable:!0,strokeWeight:3,geodesic:!0};e.$watch(angular.bind(this,function(){return this.search}),function(a){a&&"undefined"!==a&&void 0!==a&&"function"!=typeof a&&(O.data.searchForm.select=a.query.select,O.data.searchForm.filter=a.query.filter,O.data.searchForm.orderby=a.query.orderby,O.data.searchForm.top=a.query.top,O.data.searchForm.skip=a.query.skip,O.data.error=null,O.data.results=null,O.data.searching=!1,O.data.total_results=-1,h())}),O.data={searchForm:{select:"",filter:[{value:"",join:"and"}],orderby:[{value:"",direction:"asc"}],top:"",skip:"",geo:{intersects:{points:[]},within:{center:{},distance:-1}}},map:{center:{latitude:39.9612,longitude:-82.9988},zoom:11,drawingManagerOptions:{},drawingManagerControl:{},bounds:{},shape:{circle:null,rectangle:null,polygon:null},markers:[]},fullRequest:a.apiUrl+"property?",request:"",results:null,total_results:-1,error:null,searching:!1,query_time:-1},l.then(function(a){O.data.map.drawingManagerOptions={drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.RECTANGLE]},polygonOptions:x,circleOptions:x,rectangleOptions:x}}),i.promise().then(function(a){var e=a[0].map;google.maps.event.addListener(O.data.map.drawingManagerControl.getDrawingManager(),"circlecomplete",function(a){F(a)}),google.maps.event.addListener(O.data.map.drawingManagerControl.getDrawingManager(),"polygoncomplete",function(a){b(a)}),google.maps.event.addListener(O.data.map.drawingManagerControl.getDrawingManager(),"rectanglecomplete",function(a){w(a)}),google.maps.event.addListener(O.data.map.drawingManagerControl.getDrawingManager(),"overlaycomplete",function(a){var e=O.data.map.drawingManagerControl.getDrawingManager();a.type!=google.maps.drawing.OverlayType.MARKER&&(e.setDrawingMode(null),e.setOptions({drawingControl:!1}))});var t=document.createElement("div");new M(t,e);t.index=1,e.controls[google.maps.ControlPosition.TOP_RIGHT].push(t)}),O.doSearch=s,O.addFilter=d,O.removeFilter=g,O.addOrderby=c,O.removeOrderby=p,O.updateQuery=h}];return{restrict:"EA",scope:!0,link:function(a,e,t,r){},templateUrl:"explorer.bootstrap.html",controller:t,controllerAs:"vm",bindToController:{search:"=",loader:"="}}}angular.module("rr.api.v2.explorer.directive.explorer",[]).directive("apiExplorer",a),a.$inject=["ApiConfig","PropertyFactory"]}();
!function(){"use strict";angular.module("rr.api.v2.explorer.directives",["rr.api.v2.explorer.directive.explorer"])}();
!function(){"use strict";angular.module("rr.api.v2.explorer.filters",["rr.api.v2.explorer.filter.prettyJson"])}();
!function(){"use strict";function r(){return function(r){return"string"!=typeof r&&(r=JSON.stringify(r,void 0,4)),r}}angular.module("rr.api.v2.explorer.filter.prettyJson",[]).filter("prettyJson",r)}();